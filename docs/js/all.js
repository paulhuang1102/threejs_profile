'use strict';

var data = void 0;

var scene = void 0,
    renderer = void 0,
    camera = void 0,
    light = void 0;

var pic = void 0,
    linkLeft = void 0;

var width = void 0,
    height = void 0;

var raycaster = void 0,
    mouse = void 0,
    control = void 0;

var init = function init() {
    loadData(function (res) {
        data = JSON.parse(res);
        console.log(data);
        window.addEventListener('resize', onResize, false);

        width = window.innerWidth;
        height = window.innerHeight - 20;

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(width, height);
        document.getElementById('main').appendChild(renderer.domElement);

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
        camera.position.set(0, 0, 2);
        scene.add(camera);

        light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0, 10, 0);
        // light.castShadow = true;
        scene.add(light);

        // for click target ლ(ﾟдﾟლ)
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        control = new THREE.OrbitControls(camera, renderer.domElement);

        renderContent();
        renderSkybox();
        animate();

        window.addEventListener('click', onClick, false);
    });
};

var renderContent = function renderContent() {
    var picGeom = new THREE.PlaneGeometry(1, 1);
    var picMat = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/img/' + data.userImage)
    });

    pic = new THREE.Mesh(picGeom, picMat);
    pic.position.set(0, 0, -4);
    pic.name = 'david';
    scene.add(pic);

    var planeGeom = new THREE.PlaneGeometry(7, 7);
    var planeMat = new THREE.MeshPhongMaterial({ color: 0xdddddd, side: THREE.DoubleSide });
    var plane = new THREE.Mesh(planeGeom, planeMat);
    plane.rotation.x = Math.PI / 2;
    plane.position.z = -1;
    plane.position.y = -1;
    scene.add(plane);

    // create profile name (╯-_-)╯
    var fontLoader = new THREE.FontLoader();
    fontLoader.load('./assets/fonts/helvetiker_bold.typeface.json', function (font) {
        var fontGeom = new THREE.TextGeometry(data.name, {
            font: font,
            size: .8,
            height: .2

        });
        var fontFront = new THREE.MeshBasicMaterial({
            color: 0xff0000
        });
        var fontSide = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });

        var fontMesh = new THREE.Mesh(fontGeom, [fontFront, fontSide]);
        fontMesh.position.set(-1.5, 1, -4);
        scene.add(fontMesh);

        fontGeom.computeBoundingBox();
        fontGeom.textWidth = 1;
    });

    // load David model ╮(╯◇╰)╭
    var objLoader = new THREE.OBJLoader();
    objLoader.load('./assets/obj/davidprint.obj', function (mesh) {
        mesh.scale.set(.02, .02, .02);
        mesh.position.set(-2.5, -1, -4);
        scene.add(mesh);
    });

    linkLeft = new THREE.Mesh(new THREE.CircleGeometry(.5, 32), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/img/' + data.linkLeft.image)
    }));
    linkLeft.position.set(-4, 0, -4);
    linkLeft.rotation.y = Math.PI / 6;
    linkLeft.name = 'linkLeft';
    scene.add(linkLeft);
};

var renderSkybox = function renderSkybox() {
    var skyboxGeom = new THREE.CubeGeometry(100, 100, 100);
    var skyboxMat = [new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/ft.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/bk.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/up.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/dn.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/rt.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/lf.png'),
        side: THREE.DoubleSide
    })];

    var skybox = new THREE.Mesh(skyboxGeom, skyboxMat);
    scene.add(skybox);
};

var onResize = function onResize() {
    width = window.innerWidth;
    height = window.innerHeight - 20;

    camera.aspect = width / height;
    camera.updateProjectionMatrix();
    renderer.setSize(width, height);
};

var animate = function animate() {
    requestAnimationFrame(animate);
    render();
};

var onClick = function onClick(e) {
    e.preventDefault();
    mouse.x = e.clientX / window.innerWidth * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    var intersects = raycaster.intersectObjects([pic, linkLeft]);
    if (intersects.length > 0) {
        console.log(intersects[0].object);
        if (intersects[0].object.name === 'linkLeft') {
            window.open(data.linkLeft.url);
        }
    }
};

var render = function render() {
    renderer.render(scene, camera);
};

var loadData = function loadData(callback) {
    var xhr = new XMLHttpRequest();
    xhr.overrideMimeType('application/json');
    xhr.open('GET', 'config.json', true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == '200') {
            callback(xhr.responseText);
        }
    };
    xhr.send();
};

window.onload = init;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyJdLCJuYW1lcyI6WyJkYXRhIiwic2NlbmUiLCJyZW5kZXJlciIsImNhbWVyYSIsImxpZ2h0IiwicGljIiwibGlua0xlZnQiLCJ3aWR0aCIsImhlaWdodCIsInJheWNhc3RlciIsIm1vdXNlIiwiY29udHJvbCIsImluaXQiLCJsb2FkRGF0YSIsInJlcyIsIkpTT04iLCJwYXJzZSIsImNvbnNvbGUiLCJsb2ciLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwib25SZXNpemUiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJUSFJFRSIsIldlYkdMUmVuZGVyZXIiLCJzZXRTaXplIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwiZG9tRWxlbWVudCIsIlNjZW5lIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJwb3NpdGlvbiIsInNldCIsImFkZCIsIkRpcmVjdGlvbmFsTGlnaHQiLCJSYXljYXN0ZXIiLCJWZWN0b3IyIiwiT3JiaXRDb250cm9scyIsInJlbmRlckNvbnRlbnQiLCJyZW5kZXJTa3lib3giLCJhbmltYXRlIiwib25DbGljayIsInBpY0dlb20iLCJQbGFuZUdlb21ldHJ5IiwicGljTWF0IiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJtYXAiLCJUZXh0dXJlTG9hZGVyIiwibG9hZCIsInVzZXJJbWFnZSIsIk1lc2giLCJuYW1lIiwicGxhbmVHZW9tIiwicGxhbmVNYXQiLCJNZXNoUGhvbmdNYXRlcmlhbCIsImNvbG9yIiwic2lkZSIsIkRvdWJsZVNpZGUiLCJwbGFuZSIsInJvdGF0aW9uIiwieCIsIk1hdGgiLCJQSSIsInoiLCJ5IiwiZm9udExvYWRlciIsIkZvbnRMb2FkZXIiLCJmb250IiwiZm9udEdlb20iLCJUZXh0R2VvbWV0cnkiLCJzaXplIiwiZm9udEZyb250IiwiZm9udFNpZGUiLCJmb250TWVzaCIsImNvbXB1dGVCb3VuZGluZ0JveCIsInRleHRXaWR0aCIsIm9iakxvYWRlciIsIk9CSkxvYWRlciIsIm1lc2giLCJzY2FsZSIsIkNpcmNsZUdlb21ldHJ5IiwiaW1hZ2UiLCJza3lib3hHZW9tIiwiQ3ViZUdlb21ldHJ5Iiwic2t5Ym94TWF0Iiwic2t5Ym94IiwiYXNwZWN0IiwidXBkYXRlUHJvamVjdGlvbk1hdHJpeCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNsaWVudFgiLCJjbGllbnRZIiwic2V0RnJvbUNhbWVyYSIsImludGVyc2VjdHMiLCJpbnRlcnNlY3RPYmplY3RzIiwibGVuZ3RoIiwib2JqZWN0Iiwib3BlbiIsInVybCIsImNhbGxiYWNrIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvdmVycmlkZU1pbWVUeXBlIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3BvbnNlVGV4dCIsInNlbmQiLCJvbmxvYWQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsYUFBSjs7QUFFQSxJQUFJQyxjQUFKO0FBQUEsSUFDSUMsaUJBREo7QUFBQSxJQUVJQyxlQUZKO0FBQUEsSUFHSUMsY0FISjs7QUFLQSxJQUFJQyxZQUFKO0FBQUEsSUFDSUMsaUJBREo7O0FBR0EsSUFBSUMsY0FBSjtBQUFBLElBQ0lDLGVBREo7O0FBR0EsSUFBSUMsa0JBQUo7QUFBQSxJQUNJQyxjQURKO0FBQUEsSUFFSUMsZ0JBRko7O0FBSUEsSUFBTUMsT0FBTyxTQUFQQSxJQUFPLEdBQU07QUFDZkMsYUFBUyxVQUFDQyxHQUFELEVBQVM7QUFDZGQsZUFBT2UsS0FBS0MsS0FBTCxDQUFXRixHQUFYLENBQVA7QUFDQUcsZ0JBQVFDLEdBQVIsQ0FBWWxCLElBQVo7QUFDQW1CLGVBQU9DLGdCQUFQLENBQXdCLFFBQXhCLEVBQWtDQyxRQUFsQyxFQUE0QyxLQUE1Qzs7QUFFQWQsZ0JBQVFZLE9BQU9HLFVBQWY7QUFDQWQsaUJBQVNXLE9BQU9JLFdBQVAsR0FBcUIsRUFBOUI7O0FBRUFyQixtQkFBVyxJQUFJc0IsTUFBTUMsYUFBVixFQUFY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d0J0RixLQUF4QixFQUErQlAsTUFBL0I7QUFDQSxRQUFJOEYsYUFBYXhGLFVBQVV5RixnQkFBVixDQUEyQixDQUFDN0YsR0FBRCxFQUFNQyxRQUFOLENBQTNCLENBQWpCO0FBQ0EsUUFBSTJGLFdBQVdFLE1BQVgsR0FBb0IsQ0FBeEIsRUFBMkI7QUFDdkJsRixnQkFBUUMsR0FBUixDQUFZK0UsV0FBVyxDQUFYLEVBQWNHLE1BQTFCO0FBQ0EsWUFBSUgsV0FBVyxDQUFYLEVBQWNHLE1BQWQsQ0FBcUIvQyxJQUFyQixLQUE4QixVQUFsQyxFQUE4QztBQUMxQ2xDLG1CQUFPa0YsSUFBUCxDQUFZckcsS0FBS00sUUFBTCxDQUFjZ0csR0FBMUI7QUFDSDtBQUNKO0FBQ0osQ0FaRDs7QUFjQSxJQUFNWCxTQUFTLFNBQVRBLE1BQVMsR0FBTTtBQUNqQnpGLGFBQVN5RixNQUFULENBQWdCMUYsS0FBaEIsRUFBdUJFLE1BQXZCO0FBQ0gsQ0FGRDs7QUFLQSxJQUFNVSxXQUFXLFNBQVhBLFFBQVcsQ0FBQzBGLFFBQUQsRUFBYztBQUMzQixRQUFNQyxNQUFNLElBQUlDLGNBQUosRUFBWjtBQUNBRCxRQUFJRSxnQkFBSixDQUFxQixrQkFBckI7QUFDQUYsUUFBSUgsSUFBSixDQUFTLEtBQVQsRUFBZ0IsYUFBaEIsRUFBK0IsSUFBL0I7QUFDQUcsUUFBSUcsa0JBQUosR0FBeUIsWUFBTTtBQUMzQixZQUFJSCxJQUFJSSxVQUFKLElBQWtCLENBQWxCLElBQXVCSixJQUFJSyxNQUFKLElBQWMsS0FBekMsRUFBZ0Q7QUFDNUNOLHFCQUFTQyxJQUFJTSxZQUFiO0FBQ0g7QUFDSixLQUpEO0FBS0FOLFFBQUlPLElBQUo7QUFDSCxDQVZEOztBQWFBNUYsT0FBTzZGLE1BQVAsR0FBZ0JwRyxJQUFoQiIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgZGF0YTtcclxuXHJcbmxldCBzY2VuZSxcclxuICAgIHJlbmRlcmVyLFxyXG4gICAgY2FtZXJhLFxyXG4gICAgbGlnaHQ7XHJcblxyXG5sZXQgcGljLFxyXG4gICAgbGlua0xlZnQ7XHJcblxyXG5sZXQgd2lkdGgsXHJcbiAgICBoZWlnaHQ7XHJcblxyXG5sZXQgcmF5Y2FzdGVyLFxyXG4gICAgbW91c2UsXHJcbiAgICBjb250cm9sO1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIGxvYWREYXRhKChyZXMpID0+IHtcclxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSwgZmFsc2UpO1xyXG5cclxuICAgICAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG5cclxuICAgICAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xyXG5cclxuICAgICAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgICAgICBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNDUsIHdpZHRoIC8gaGVpZ2h0LCAxLCAxMDAwMCk7XHJcbiAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAwLCAyKTtcclxuICAgICAgICBzY2VuZS5hZGQoY2FtZXJhKTtcclxuXHJcbiAgICAgICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZik7XHJcbiAgICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAsIDEwLCAwKTtcclxuICAgICAgICAvLyBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZTtcclxuICAgICAgICBzY2VuZS5hZGQobGlnaHQpO1xyXG5cclxuICAgICAgICAvLyBmb3IgY2xpY2sgdGFyZ2V0IOGDmijvvp/QtO++n+GDmilcclxuICAgICAgICByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7XHJcbiAgICAgICAgbW91c2UgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuICAgICAgICBjb250cm9sID0gbmV3IFRIUkVFLk9yYml0Q29udHJvbHMoY2FtZXJhLCByZW5kZXJlci5kb21FbGVtZW50KTtcclxuXHJcbiAgICAgICAgcmVuZGVyQ29udGVudCgpO1xyXG4gICAgICAgIHJlbmRlclNreWJveCgpO1xyXG4gICAgICAgIGFuaW1hdGUoKTtcclxuXHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGljaywgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5jb25zdCByZW5kZXJDb250ZW50ID0gKCkgPT4ge1xyXG4gICAgY29uc3QgcGljR2VvbSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDEsIDEpO1xyXG4gICAgY29uc3QgcGljTWF0ID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvaW1nLycgKyBkYXRhLnVzZXJJbWFnZSlcclxuICAgIH0pO1xyXG5cclxuICAgIHBpYyA9IG5ldyBUSFJFRS5NZXNoKHBpY0dlb20sIHBpY01hdCk7XHJcbiAgICBwaWMucG9zaXRpb24uc2V0KDAsIDAsIC00KTtcclxuICAgIHBpYy5uYW1lID0gJ2RhdmlkJztcclxuICAgIHNjZW5lLmFkZChwaWMpO1xyXG5cclxuICAgIGNvbnN0IHBsYW5lR2VvbSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDcsIDcpO1xyXG4gICAgY29uc3QgcGxhbmVNYXQgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhkZGRkZGQsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7XHJcbiAgICBjb25zdCBwbGFuZSA9IG5ldyBUSFJFRS5NZXNoKHBsYW5lR2VvbSwgcGxhbmVNYXQpO1xyXG4gICAgcGxhbmUucm90YXRpb24ueCA9IE1hdGguUEkgLyAyO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueiA9IC0xO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueSA9IC0xO1xyXG4gICAgc2NlbmUuYWRkKHBsYW5lKTtcclxuXHJcblxyXG4gICAgLy8gY3JlYXRlIHByb2ZpbGUgbmFtZSAo4pWvLV8tKeKVr1xyXG4gICAgY29uc3QgZm9udExvYWRlciA9IG5ldyBUSFJFRS5Gb250TG9hZGVyKCk7XHJcbiAgICBmb250TG9hZGVyLmxvYWQoJy4vYXNzZXRzL2ZvbnRzL2hlbHZldGlrZXJfYm9sZC50eXBlZmFjZS5qc29uJywgKGZvbnQpID0+IHtcclxuICAgICAgICBjb25zdCBmb250R2VvbSA9IG5ldyBUSFJFRS5UZXh0R2VvbWV0cnkoZGF0YS5uYW1lLCB7XHJcbiAgICAgICAgICAgIGZvbnQsXHJcbiAgICAgICAgICAgIHNpemU6IC44LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IC4yLFxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250RnJvbnQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBjb2xvcjogMHhmZjAwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250U2lkZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBmb250TWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZvbnRHZW9tLCBbZm9udEZyb250LCBmb250U2lkZV0pO1xyXG4gICAgICAgIGZvbnRNZXNoLnBvc2l0aW9uLnNldCgtMS41LCAxLCAtNCk7XHJcbiAgICAgICAgc2NlbmUuYWRkKGZvbnRNZXNoKTtcclxuXHJcbiAgICAgICAgZm9udEdlb20uY29tcHV0ZUJvdW5kaW5nQm94KCk7XHJcbiAgICAgICAgZm9udEdlb20udGV4dFdpZHRoID0gMTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAvLyBsb2FkIERhdmlkIG1vZGVsIOKVrijila/il4filbAp4pWtXHJcbiAgICBjb25zdCBvYmpMb2FkZXIgPSBuZXcgVEhSRUUuT0JKTG9hZGVyKCk7XHJcbiAgICBvYmpMb2FkZXIubG9hZCgnLi9hc3NldHMvb2JqL2RhdmlkcHJpbnQub2JqJywgKG1lc2gpID0+IHtcclxuICAgICAgICBtZXNoLnNjYWxlLnNldCguMDIsIC4wMiwgLjAyKTtcclxuICAgICAgICBtZXNoLnBvc2l0aW9uLnNldCgtMi41LCAtMSwgLTQpO1xyXG4gICAgICAgIHNjZW5lLmFkZChtZXNoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGxpbmtMZWZ0ID0gbmV3IFRIUkVFLk1lc2goXHJcbiAgICAgICAgbmV3IFRIUkVFLkNpcmNsZUdlb21ldHJ5KC41LCAzMiksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL2ltZy8nICsgZGF0YS5saW5rTGVmdC5pbWFnZSlcclxuICAgICAgICB9KVxyXG4gICAgKTtcclxuICAgIGxpbmtMZWZ0LnBvc2l0aW9uLnNldCgtNCwgMCwgLTQpO1xyXG4gICAgbGlua0xlZnQucm90YXRpb24ueSA9IE1hdGguUEkgLyA2O1xyXG4gICAgbGlua0xlZnQubmFtZSA9ICdsaW5rTGVmdCc7XHJcbiAgICBzY2VuZS5hZGQobGlua0xlZnQpO1xyXG5cclxufTtcclxuXHJcbmNvbnN0IHJlbmRlclNreWJveCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHNreWJveEdlb20gPSBuZXcgVEhSRUUuQ3ViZUdlb21ldHJ5KDEwMCwgMTAwLCAxMDApO1xyXG4gICAgY29uc3Qgc2t5Ym94TWF0ID0gW1xyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvZnQucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L2JrLnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC91cC5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvZG4ucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L3J0LnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC9sZi5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBza3lib3ggPSBuZXcgVEhSRUUuTWVzaChza3lib3hHZW9tLCBza3lib3hNYXQpO1xyXG4gICAgc2NlbmUuYWRkKHNreWJveCk7XHJcbn07XHJcblxyXG5cclxuY29uc3Qgb25SZXNpemUgPSAoKSA9PiB7XHJcbiAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcblxyXG4gICAgY2FtZXJhLmFzcGVjdCA9IHdpZHRoIC8gaGVpZ2h0O1xyXG4gICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuICAgIHJlbmRlcmVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7XHJcbn07XHJcblxyXG5jb25zdCBhbmltYXRlID0gKCkgPT4ge1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xyXG4gICAgcmVuZGVyKCk7XHJcbn07XHJcblxyXG5jb25zdCBvbkNsaWNrID0gKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIG1vdXNlLnggPSAoZS5jbGllbnRYIC8gd2luZG93LmlubmVyV2lkdGgpICogMiAtIDE7XHJcbiAgICBtb3VzZS55ID0gLShlLmNsaWVudFkgLyB3aW5kb3cuaW5uZXJIZWlnaHQpICogMiArIDE7XHJcbiAgICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYShtb3VzZSwgY2FtZXJhKTtcclxuICAgIGxldCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHMoW3BpYywgbGlua0xlZnRdKTtcclxuICAgIGlmIChpbnRlcnNlY3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhpbnRlcnNlY3RzWzBdLm9iamVjdCk7XHJcbiAgICAgICAgaWYgKGludGVyc2VjdHNbMF0ub2JqZWN0Lm5hbWUgPT09ICdsaW5rTGVmdCcpIHtcclxuICAgICAgICAgICAgd2luZG93Lm9wZW4oZGF0YS5saW5rTGVmdC51cmwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IHJlbmRlciA9ICgpID0+IHtcclxuICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKVxyXG59O1xyXG5cclxuXHJcbmNvbnN0IGxvYWREYXRhID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgICB4aHIub3BlbignR0VUJywgJ2NvbmZpZy5qc29uJywgdHJ1ZSk7XHJcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PSA0ICYmIHhoci5zdGF0dXMgPT0gJzIwMCcpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soeGhyLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7XHJcbn07XHJcblxyXG5cclxud2luZG93Lm9ubG9hZCA9IGluaXQ7Il19
