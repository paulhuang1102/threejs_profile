'use strict';

var data = void 0;

var scene = void 0,
    renderer = void 0,
    camera = void 0,
    light = void 0;

var pic = void 0,
    linkLeft = void 0,
    table = void 0;

var width = void 0,
    height = void 0;

var raycaster = void 0,
    mouse = void 0,
    control = void 0;

var objLoader = void 0,
    mtlLoader = void 0;

var init = function init() {
    loadData(function (res) {
        data = JSON.parse(res);
        console.log(data);
        window.addEventListener('resize', onResize, false);

        width = window.innerWidth;
        height = window.innerHeight - 20;

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(width, height);
        document.getElementById('main').appendChild(renderer.domElement);

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
        camera.position.set(0, 0, 2);
        scene.add(camera);

        light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0, 10, 0);
        // light.castShadow = true;
        scene.add(light);

        // for click target ლ(ﾟдﾟლ)
        raycaster = new THREE.Raycaster();
        mouse = new THREE.Vector2();

        control = new THREE.OrbitControls(camera, renderer.domElement);

        renderContent();
        renderSkybox();
        animate();

        window.addEventListener('click', onClick, false);
    });
};

var renderContent = function renderContent() {
    objLoader = new THREE.OBJLoader();
    mtlLoader = new THREE.MTLLoader();

    var picGeom = new THREE.PlaneGeometry(1, 1);
    var picMat = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/img/' + data.userImage)
    });

    pic = new THREE.Mesh(picGeom, picMat);
    pic.position.set(0, .17, -4);
    pic.name = 'david';
    scene.add(pic);

    var planeGeom = new THREE.PlaneGeometry(7, 7);
    var planeMat = new THREE.MeshPhongMaterial({ color: 0xdddddd, side: THREE.DoubleSide });
    var plane = new THREE.Mesh(planeGeom, planeMat);
    plane.rotation.x = Math.PI / 2;
    plane.position.z = -1;
    plane.position.y = -1;
    scene.add(plane);

    // create profile name (╯-_-)╯
    var fontLoader = new THREE.FontLoader();
    fontLoader.load('./assets/fonts/helvetiker_bold.typeface.json', function (font) {
        var fontGeom = new THREE.TextGeometry(data.name, {
            font: font,
            size: .8,
            height: .2

        });
        var fontFront = new THREE.MeshBasicMaterial({
            color: 0xff0000
        });
        var fontSide = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });

        var fontMesh = new THREE.Mesh(fontGeom, [fontFront, fontSide]);
        fontMesh.position.set(-1.5, 1, -4);
        scene.add(fontMesh);

        fontGeom.computeBoundingBox();
        fontGeom.textWidth = 1;
    });

    // load David model ╮(╯◇╰)╭
    objLoader.load('./assets/obj/davidprint.obj', function (mesh) {
        mesh.scale.set(.02, .02, .02);
        mesh.position.set(-2.5, -1, -4);
        scene.add(mesh);
    });

    var dLight = new THREE.DirectionalLight(0xffffff, 1, 100);
    dLight.position.set(.5, -1, 0);
    scene.add(dLight);

    linkLeft = new THREE.Mesh(new THREE.CircleGeometry(.5, 32), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/img/' + data.linkLeft.image)
    }));
    linkLeft.position.set(-4, 0, -4);
    linkLeft.rotation.y = Math.PI / 6;
    linkLeft.name = 'linkLeft';
    scene.add(linkLeft);

    var shaderMat = new THREE.ShaderMaterial({
        uniforms: {
            "c": { type: "f", value: 1.0 },
            "p": { type: "f", value: 1.4 },
            glowColor: { type: "c", value: new THREE.Color(0xffff00) },
            viewVector: { type: "v3", value: camera.position }
        },
        vertexShader: document.getElementById('vertexShader').textContent,
        fragmentShader: document.getElementById('fragmentShader').textContent,
        side: THREE.FrontSide,
        blending: THREE.AdditiveBlending,
        transparent: true
    });

    var linkLeftGlow = new THREE.Mesh(new THREE.SphereGeometry(.7, 32, 16), shaderMat);
    linkLeftGlow.position.x = linkLeft.position.x;
    linkLeftGlow.position.y = linkLeft.position.y;
    linkLeftGlow.position.z = linkLeft.position.z;
    scene.add(linkLeftGlow);

    var picGlow = new THREE.Mesh(new THREE.SphereGeometry(.8, 32, 16), shaderMat);
    picGlow.position.x = pic.position.x;
    picGlow.position.y = pic.position.y;
    picGlow.position.z = pic.position.z;
    scene.add(picGlow);

    mtlLoader.load('./assets/obj/wooden-coffe-table.mtl', function (mat) {
        mat.preload();
        objLoader.setMaterials(mat);
        objLoader.load('./assets/obj/wooden-coffe-table.obj', function (mesh) {
            mesh.scale.set(.5, .5, .5);
            mesh.position.set(0, -1, -4);
            scene.add(mesh);
        });
    });
};

var renderSkybox = function renderSkybox() {
    var skyboxGeom = new THREE.CubeGeometry(100, 100, 100);
    var skyboxMat = [new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/ft.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/bk.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/up.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/dn.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/rt.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/lf.png'),
        side: THREE.DoubleSide
    })];

    var skybox = new THREE.Mesh(skyboxGeom, skyboxMat);
    scene.add(skybox);
};

var onResize = function onResize() {
    width = window.innerWidth;
    height = window.innerHeight - 20;

    camera.aspect = width / height;
    camera.updateProjectionMatrix();
    renderer.setSize(width, height);
};

var animate = function animate() {
    requestAnimationFrame(animate);
    render();
};

var onClick = function onClick(e) {
    e.preventDefault();
    mouse.x = e.clientX / window.innerWidth * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    var intersects = raycaster.intersectObjects([pic, linkLeft]);
    if (intersects.length > 0) {
        console.log(intersects[0].object);
        if (intersects[0].object.name === 'linkLeft') {
            window.open(data.linkLeft.url);
        }
    }
};

var render = function render() {
    renderer.render(scene, camera);
};

var loadData = function loadData(callback) {
    var xhr = new XMLHttpRequest();
    xhr.overrideMimeType('application/json');
    xhr.open('GET', 'config.json', true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == '200') {
            callback(xhr.responseText);
        }
    };
    xhr.send();
};

window.onload = init;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyJdLCJuYW1lcyI6WyJkYXRhIiwic2NlbmUiLCJyZW5kZXJlciIsImNhbWVyYSIsImxpZ2h0IiwicGljIiwibGlua0xlZnQiLCJ0YWJsZSIsIndpZHRoIiwiaGVpZ2h0IiwicmF5Y2FzdGVyIiwibW91c2UiLCJjb250cm9sIiwib2JqTG9hZGVyIiwibXRsTG9hZGVyIiwiaW5pdCIsImxvYWREYXRhIiwicmVzIiwiSlNPTiIsInBhcnNlIiwiY29uc29sZSIsImxvZyIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblJlc2l6ZSIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsIlRIUkVFIiwiV2ViR0xSZW5kZXJlciIsInNldFNpemUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiYXBwZW5kQ2hpbGQiLCJkb21FbGVtZW50IiwiU2NlbmUiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInBvc2l0aW9uIiwic2V0IiwiYWRkIiwiRGlyZWN0aW9uYWxMaWdodCIsIlJheWNhc3RlciIsIlZlY3RvcjIiLCJPcmJpdENvbnRyb2xzIiwicmVuZGVyQ29udGVudCIsInJlbmRlclNreWJveCIsImFuaW1hdGUiLCJvbkNsaWNrIiwiT0JKTG9hZGVyIiwiTVRMTG9hZGVyIiwicGljR2VvbSIsIlBsYW5lR2VvbWV0cnkiLCJwaWNNYXQiLCJNZXNoQmFzaWNNYXRlcmlhbCIsIm1hcCIsIlRleHR1cmVMb2FkZXIiLCJsb2FkIiwidXNlckltYWdlIiwiTWVzaCIsIm5hbWUiLCJwbGFuZUdlb20iLCJwbGFuZU1hdCIsIk1lc2hQaG9uZ01hdGVyaWFsIiwiY29sb3IiLCJzaWRlIiwiRG91YmxlU2lkZSIsInBsYW5lIiwicm90YXRpb24iLCJ4IiwiTWF0aCIsIlBJIiwieiIsInkiLCJmb250TG9hZGVyIiwiRm9udExvYWRlciIsImZvbnQiLCJmb250R2VvbSIsIlRleHRHZW9tZXRyeSIsInNpemUiLCJmb250RnJvbnQiLCJmb250U2lkZSIsImZvbnRNZXNoIiwiY29tcHV0ZUJvdW5kaW5nQm94IiwidGV4dFdpZHRoIiwibWVzaCIsInNjYWxlIiwiZExpZ2h0IiwiQ2lyY2xlR2VvbWV0cnkiLCJpbWFnZSIsInNoYWRlck1hdCIsIlNoYWRlck1hdGVyaWFsIiwidW5pZm9ybXMiLCJ0eXBlIiwidmFsdWUiLCJnbG93Q29sb3IiLCJDb2xvciIsInZpZXdWZWN0b3IiLCJ2ZXJ0ZXhTaGFkZXIiLCJ0ZXh0Q29udGVudCIsImZyYWdtZW50U2hhZGVyIiwiRnJvbnRTaWRlIiwiYmxlbmRpbmciLCJBZGRpdGl2ZUJsZW5kaW5nIiwidHJhbnNwYXJlbnQiLCJsaW5rTGVmdEdsb3ciLCJTcGhlcmVHZW9tZXRyeSIsInBpY0dsb3ciLCJtYXQiLCJwcmVsb2FkIiwic2V0TWF0ZXJpYWxzIiwic2t5Ym94R2VvbSIsIkN1YmVHZW9tZXRyeSIsInNreWJveE1hdCIsInNreWJveCIsImFzcGVjdCIsInVwZGF0ZVByb2plY3Rpb25NYXRyaXgiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJyZW5kZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJjbGllbnRYIiwiY2xpZW50WSIsInNldEZyb21DYW1lcmEiLCJpbnRlcnNlY3RzIiwiaW50ZXJzZWN0T2JqZWN0cyIsImxlbmd0aCIsIm9iamVjdCIsIm9wZW4iLCJ1cmwiLCJjYWxsYmFjayIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3ZlcnJpZGVNaW1lVHlwZSIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJzZW5kIiwib25sb2FkIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLGFBQUo7O0FBRUEsSUFBSUMsY0FBSjtBQUFBLElBQ0lDLGlCQURKO0FBQUEsSUFFSUMsZUFGSjtBQUFBLElBR0lDLGNBSEo7O0FBS0EsSUFBSUMsWUFBSjtBQUFBLElBQ0lDLGlCQURKO0FBQUEsSUFFSUMsY0FGSjs7QUFJQSxJQUFJQyxjQUFKO0FBQUEsSUFDSUMsZUFESjs7QUFHQSxJQUFJQyxr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R0FBeUIsWUFBTTtBQUMzQixZQUFJSCxJQUFJSSxVQUFKLElBQWtCLENBQWxCLElBQXVCSixJQUFJSyxNQUFKLElBQWMsS0FBekMsRUFBZ0Q7QUFDNUNOLHFCQUFTQyxJQUFJTSxZQUFiO0FBQ0g7QUFDSixLQUpEO0FBS0FOLFFBQUlPLElBQUo7QUFDSCxDQVZEOztBQWFBbEgsT0FBT21ILE1BQVAsR0FBZ0IxSCxJQUFoQiIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgZGF0YTtcclxuXHJcbmxldCBzY2VuZSxcclxuICAgIHJlbmRlcmVyLFxyXG4gICAgY2FtZXJhLFxyXG4gICAgbGlnaHQ7XHJcblxyXG5sZXQgcGljLFxyXG4gICAgbGlua0xlZnQsXHJcbiAgICB0YWJsZTtcclxuXHJcbmxldCB3aWR0aCxcclxuICAgIGhlaWdodDtcclxuXHJcbmxldCByYXljYXN0ZXIsXHJcbiAgICBtb3VzZSxcclxuICAgIGNvbnRyb2w7XHJcblxyXG5sZXQgb2JqTG9hZGVyLFxyXG4gICAgbXRsTG9hZGVyO1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIGxvYWREYXRhKChyZXMpID0+IHtcclxuICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShyZXMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSwgZmFsc2UpO1xyXG5cclxuICAgICAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG5cclxuICAgICAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xyXG5cclxuICAgICAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgICAgICBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNDUsIHdpZHRoIC8gaGVpZ2h0LCAxLCAxMDAwMCk7XHJcbiAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnNldCgwLCAwLCAyKTtcclxuICAgICAgICBzY2VuZS5hZGQoY2FtZXJhKTtcclxuXHJcbiAgICAgICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZik7XHJcbiAgICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAsIDEwLCAwKTtcclxuICAgICAgICAvLyBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZTtcclxuICAgICAgICBzY2VuZS5hZGQobGlnaHQpO1xyXG5cclxuICAgICAgICAvLyBmb3IgY2xpY2sgdGFyZ2V0IOGDmijvvp/QtO++n+GDmilcclxuICAgICAgICByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7XHJcbiAgICAgICAgbW91c2UgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuICAgICAgICBjb250cm9sID0gbmV3IFRIUkVFLk9yYml0Q29udHJvbHMoY2FtZXJhLCByZW5kZXJlci5kb21FbGVtZW50KTtcclxuXHJcbiAgICAgICAgcmVuZGVyQ29udGVudCgpO1xyXG4gICAgICAgIHJlbmRlclNreWJveCgpO1xyXG4gICAgICAgIGFuaW1hdGUoKTtcclxuXHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGljaywgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5jb25zdCByZW5kZXJDb250ZW50ID0gKCkgPT4ge1xyXG4gICAgb2JqTG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xyXG4gICAgbXRsTG9hZGVyID0gbmV3IFRIUkVFLk1UTExvYWRlcigpO1xyXG5cclxuICAgIGNvbnN0IHBpY0dlb20gPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeSgxLCAxKTtcclxuICAgIGNvbnN0IHBpY01hdCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL2ltZy8nICsgZGF0YS51c2VySW1hZ2UpXHJcbiAgICB9KTtcclxuXHJcbiAgICBwaWMgPSBuZXcgVEhSRUUuTWVzaChwaWNHZW9tLCBwaWNNYXQpO1xyXG4gICAgcGljLnBvc2l0aW9uLnNldCgwLCAuMTcsIC00KTtcclxuICAgIHBpYy5uYW1lID0gJ2RhdmlkJztcclxuICAgIHNjZW5lLmFkZChwaWMpO1xyXG5cclxuICAgIGNvbnN0IHBsYW5lR2VvbSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDcsIDcpO1xyXG4gICAgY29uc3QgcGxhbmVNYXQgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhkZGRkZGQsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7XHJcbiAgICBjb25zdCBwbGFuZSA9IG5ldyBUSFJFRS5NZXNoKHBsYW5lR2VvbSwgcGxhbmVNYXQpO1xyXG4gICAgcGxhbmUucm90YXRpb24ueCA9IE1hdGguUEkgLyAyO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueiA9IC0xO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueSA9IC0xO1xyXG4gICAgc2NlbmUuYWRkKHBsYW5lKTtcclxuXHJcblxyXG4gICAgLy8gY3JlYXRlIHByb2ZpbGUgbmFtZSAo4pWvLV8tKeKVr1xyXG4gICAgY29uc3QgZm9udExvYWRlciA9IG5ldyBUSFJFRS5Gb250TG9hZGVyKCk7XHJcbiAgICBmb250TG9hZGVyLmxvYWQoJy4vYXNzZXRzL2ZvbnRzL2hlbHZldGlrZXJfYm9sZC50eXBlZmFjZS5qc29uJywgKGZvbnQpID0+IHtcclxuICAgICAgICBjb25zdCBmb250R2VvbSA9IG5ldyBUSFJFRS5UZXh0R2VvbWV0cnkoZGF0YS5uYW1lLCB7XHJcbiAgICAgICAgICAgIGZvbnQsXHJcbiAgICAgICAgICAgIHNpemU6IC44LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IC4yLFxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250RnJvbnQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBjb2xvcjogMHhmZjAwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250U2lkZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBmb250TWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZvbnRHZW9tLCBbZm9udEZyb250LCBmb250U2lkZV0pO1xyXG4gICAgICAgIGZvbnRNZXNoLnBvc2l0aW9uLnNldCgtMS41LCAxLCAtNCk7XHJcbiAgICAgICAgc2NlbmUuYWRkKGZvbnRNZXNoKTtcclxuXHJcbiAgICAgICAgZm9udEdlb20uY29tcHV0ZUJvdW5kaW5nQm94KCk7XHJcbiAgICAgICAgZm9udEdlb20udGV4dFdpZHRoID0gMTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAvLyBsb2FkIERhdmlkIG1vZGVsIOKVrijila/il4filbAp4pWtXHJcbiAgICBvYmpMb2FkZXIubG9hZCgnLi9hc3NldHMvb2JqL2RhdmlkcHJpbnQub2JqJywgKG1lc2gpID0+IHtcclxuICAgICAgICBtZXNoLnNjYWxlLnNldCguMDIsIC4wMiwgLjAyKTtcclxuICAgICAgICBtZXNoLnBvc2l0aW9uLnNldCgtMi41LCAtMSwgLTQpO1xyXG4gICAgICAgIHNjZW5lLmFkZChtZXNoKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBjb25zdCBkTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMSwgMTAwKTtcclxuICAgIGRMaWdodC5wb3NpdGlvbi5zZXQoLjUsIC0xLCAwKTtcclxuICAgIHNjZW5lLmFkZChkTGlnaHQpO1xyXG5cclxuXHJcbiAgICBsaW5rTGVmdCA9IG5ldyBUSFJFRS5NZXNoKFxyXG4gICAgICAgIG5ldyBUSFJFRS5DaXJjbGVHZW9tZXRyeSguNSwgMzIpLFxyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9pbWcvJyArIGRhdGEubGlua0xlZnQuaW1hZ2UpXHJcbiAgICAgICAgfSlcclxuICAgICk7XHJcbiAgICBsaW5rTGVmdC5wb3NpdGlvbi5zZXQoLTQsIDAsIC00KTtcclxuICAgIGxpbmtMZWZ0LnJvdGF0aW9uLnkgPSBNYXRoLlBJIC8gNjtcclxuICAgIGxpbmtMZWZ0Lm5hbWUgPSAnbGlua0xlZnQnO1xyXG4gICAgc2NlbmUuYWRkKGxpbmtMZWZ0KTtcclxuXHJcblxyXG4gICAgY29uc3Qgc2hhZGVyTWF0ID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKHtcclxuICAgICAgICB1bmlmb3Jtczoge1xyXG4gICAgICAgICAgICBcImNcIjogeyB0eXBlOiBcImZcIiwgdmFsdWU6IDEuMCB9LFxyXG4gICAgICAgICAgICBcInBcIjogeyB0eXBlOiBcImZcIiwgdmFsdWU6IDEuNCB9LFxyXG4gICAgICAgICAgICBnbG93Q29sb3I6IHsgdHlwZTogXCJjXCIsIHZhbHVlOiBuZXcgVEhSRUUuQ29sb3IoMHhmZmZmMDApIH0sXHJcbiAgICAgICAgICAgIHZpZXdWZWN0b3I6IHsgdHlwZTogXCJ2M1wiLCB2YWx1ZTogY2FtZXJhLnBvc2l0aW9uIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZlcnRleFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcnRleFNoYWRlcicpLnRleHRDb250ZW50LFxyXG4gICAgICAgIGZyYWdtZW50U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJhZ21lbnRTaGFkZXInKS50ZXh0Q29udGVudCxcclxuICAgICAgICBzaWRlOiBUSFJFRS5Gcm9udFNpZGUsXHJcbiAgICAgICAgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsXHJcbiAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWVcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGxpbmtMZWZ0R2xvdyA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5TcGhlcmVHZW9tZXRyeSguNywgMzIsIDE2KSwgc2hhZGVyTWF0KTtcclxuICAgIGxpbmtMZWZ0R2xvdy5wb3NpdGlvbi54ID0gbGlua0xlZnQucG9zaXRpb24ueDtcclxuICAgIGxpbmtMZWZ0R2xvdy5wb3NpdGlvbi55ID0gbGlua0xlZnQucG9zaXRpb24ueTtcclxuICAgIGxpbmtMZWZ0R2xvdy5wb3NpdGlvbi56ID0gbGlua0xlZnQucG9zaXRpb24uejtcclxuICAgIHNjZW5lLmFkZChsaW5rTGVmdEdsb3cpO1xyXG5cclxuICAgIGNvbnN0IHBpY0dsb3cgPSBuZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoLjgsIDMyLCAxNiksIHNoYWRlck1hdCk7XHJcbiAgICBwaWNHbG93LnBvc2l0aW9uLnggPSBwaWMucG9zaXRpb24ueDtcclxuICAgIHBpY0dsb3cucG9zaXRpb24ueSA9IHBpYy5wb3NpdGlvbi55O1xyXG4gICAgcGljR2xvdy5wb3NpdGlvbi56ID0gcGljLnBvc2l0aW9uLno7XHJcbiAgICBzY2VuZS5hZGQocGljR2xvdyk7XHJcblxyXG4gICAgbXRsTG9hZGVyLmxvYWQoJy4vYXNzZXRzL29iai93b29kZW4tY29mZmUtdGFibGUubXRsJywgbWF0ID0+IHtcclxuICAgICAgICBtYXQucHJlbG9hZCgpO1xyXG4gICAgICAgIG9iakxvYWRlci5zZXRNYXRlcmlhbHMobWF0KTtcclxuICAgICAgICBvYmpMb2FkZXIubG9hZCgnLi9hc3NldHMvb2JqL3dvb2Rlbi1jb2ZmZS10YWJsZS5vYmonLCBtZXNoID0+IHtcclxuICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoLjUsIC41LCAuNSk7XHJcbiAgICAgICAgICAgIG1lc2gucG9zaXRpb24uc2V0KDAsIC0xLCAtNClcclxuICAgICAgICAgICAgc2NlbmUuYWRkKG1lc2gpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG5cclxuXHJcbn07XHJcblxyXG5jb25zdCByZW5kZXJTa3lib3ggPSAoKSA9PiB7XHJcbiAgICBjb25zdCBza3lib3hHZW9tID0gbmV3IFRIUkVFLkN1YmVHZW9tZXRyeSgxMDAsIDEwMCwgMTAwKTtcclxuICAgIGNvbnN0IHNreWJveE1hdCA9IFtcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L2Z0LnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC9iay5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvdXAucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L2RuLnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC9ydC5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvbGYucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgIF07XHJcblxyXG4gICAgY29uc3Qgc2t5Ym94ID0gbmV3IFRIUkVFLk1lc2goc2t5Ym94R2VvbSwgc2t5Ym94TWF0KTtcclxuICAgIHNjZW5lLmFkZChza3lib3gpO1xyXG59O1xyXG5cclxuXHJcbmNvbnN0IG9uUmVzaXplID0gKCkgPT4ge1xyXG4gICAgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDIwO1xyXG5cclxuICAgIGNhbWVyYS5hc3BlY3QgPSB3aWR0aCAvIGhlaWdodDtcclxuICAgIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XHJcbiAgICByZW5kZXJlci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpO1xyXG59O1xyXG5cclxuY29uc3QgYW5pbWF0ZSA9ICgpID0+IHtcclxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcclxuICAgIHJlbmRlcigpO1xyXG59O1xyXG5cclxuY29uc3Qgb25DbGljayA9IChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBtb3VzZS54ID0gKGUuY2xpZW50WCAvIHdpbmRvdy5pbm5lcldpZHRoKSAqIDIgLSAxO1xyXG4gICAgbW91c2UueSA9IC0oZS5jbGllbnRZIC8gd2luZG93LmlubmVySGVpZ2h0KSAqIDIgKyAxO1xyXG4gICAgcmF5Y2FzdGVyLnNldEZyb21DYW1lcmEobW91c2UsIGNhbWVyYSk7XHJcbiAgICBsZXQgaW50ZXJzZWN0cyA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3RzKFtwaWMsIGxpbmtMZWZ0XSk7XHJcbiAgICBpZiAoaW50ZXJzZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coaW50ZXJzZWN0c1swXS5vYmplY3QpO1xyXG4gICAgICAgIGlmIChpbnRlcnNlY3RzWzBdLm9iamVjdC5uYW1lID09PSAnbGlua0xlZnQnKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKGRhdGEubGlua0xlZnQudXJsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCByZW5kZXIgPSAoKSA9PiB7XHJcbiAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSlcclxufTtcclxuXHJcblxyXG5jb25zdCBsb2FkRGF0YSA9IChjYWxsYmFjaykgPT4ge1xyXG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZSgnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgeGhyLm9wZW4oJ0dFVCcsICdjb25maWcuanNvbicsIHRydWUpO1xyXG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcclxuICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCAmJiB4aHIuc3RhdHVzID09ICcyMDAnKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB4aHIuc2VuZCgpO1xyXG59O1xyXG5cclxuXHJcbndpbmRvdy5vbmxvYWQgPSBpbml0OyJdfQ==
