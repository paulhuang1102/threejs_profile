'use strict';

var scene = void 0,
    renderer = void 0,
    camera = void 0,
    light = void 0;

var pic = void 0;

var width = void 0,
    height = void 0;

var raycaster = void 0,
    mouse = void 0,
    control = void 0;

var init = function init() {
    window.addEventListener('resize', onResize, false);

    width = window.innerWidth;
    height = window.innerHeight - 20;

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(width, height);
    document.getElementById('main').appendChild(renderer.domElement);

    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
    camera.position.set(0, 0, 2);
    scene.add(camera);

    light = new THREE.DirectionalLight(0xffffff);
    light.position.set(0, 10, 0);
    // light.castShadow = true;
    scene.add(light);

    raycaster = new THREE.Raycaster();
    mouse = new THREE.Vector2();

    control = new THREE.OrbitControls(camera, renderer.domElement);

    renderContent();
    renderSkybox();
    animate();

    window.addEventListener('click', onClick, false);
};

var renderContent = function renderContent() {
    var picGeom = new THREE.PlaneGeometry(1, 1);
    var picMat = new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/img/david.jpg')
    });

    pic = new THREE.Mesh(picGeom, picMat);
    pic.position.set(0, 0, -4);
    pic.name = 'david';
    scene.add(pic);

    var planeGeom = new THREE.PlaneGeometry(7, 7);
    var planeMat = new THREE.MeshPhongMaterial({ color: 0xdddddd, side: THREE.DoubleSide });
    var plane = new THREE.Mesh(planeGeom, planeMat);
    plane.rotation.x = Math.PI / 2;
    plane.position.z = -1;
    plane.position.y = -1;
    scene.add(plane);

    var fontLoader = new THREE.FontLoader();
    fontLoader.load('./assets/fonts/helvetiker_bold.typeface.json', function (font) {
        var fontGeom = new THREE.TextGeometry('David', {
            font: font,
            size: .8,
            height: .2

        });
        var fontFront = new THREE.MeshBasicMaterial({
            color: 0xff0000
        });
        var fontSide = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });

        var fontMesh = new THREE.Mesh(fontGeom, [fontFront, fontSide]);
        fontMesh.position.set(-1.5, 1, -4);
        scene.add(fontMesh);

        fontGeom.computeBoundingBox();
        fontGeom.textWidth = 1;
    });

    var objLoader = new THREE.OBJLoader();
    objLoader.load('./assets/obj/davidprint.obj', function (mesh) {
        mesh.scale.set(.02, .02, .02);
        mesh.position.set(-2.5, -1, -4);
        scene.add(mesh);
    });
};

var renderSkybox = function renderSkybox() {
    var skyboxGeom = new THREE.CubeGeometry(100, 100, 100);
    var skyboxMat = [new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/ft.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/bk.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/up.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/dn.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/rt.png'),
        side: THREE.DoubleSide
    }), new THREE.MeshBasicMaterial({
        map: new THREE.TextureLoader().load('./assets/skybox/lf.png'),
        side: THREE.DoubleSide
    })];

    var skybox = new THREE.Mesh(skyboxGeom, skyboxMat);
    scene.add(skybox);
};

var onResize = function onResize() {
    width = window.innerWidth;
    height = window.innerHeight - 20;

    camera.aspect = width / height;
    camera.updateProjectionMatrix();
    renderer.setSize(width, height);
};

var animate = function animate() {
    requestAnimationFrame(animate);
    render();
};

var onClick = function onClick(e) {
    e.preventDefault();
    mouse.x = e.clientX / window.innerWidth * 2 - 1;
    mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    console.log(mouse);
    raycaster.setFromCamera(mouse, camera);
    var intersects = raycaster.intersectObjects([pic]);
    if (intersects.length > 0) {
        console.log(intersects[0]);
        intersects[0].object.position.z -= 1;
    }
};

var render = function render() {
    renderer.render(scene, camera);
};

window.onload = init;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyJdLCJuYW1lcyI6WyJzY2VuZSIsInJlbmRlcmVyIiwiY2FtZXJhIiwibGlnaHQiLCJwaWMiLCJ3aWR0aCIsImhlaWdodCIsInJheWNhc3RlciIsIm1vdXNlIiwiY29udHJvbCIsImluaXQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwib25SZXNpemUiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJUSFJFRSIsIldlYkdMUmVuZGVyZXIiLCJzZXRTaXplIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwiZG9tRWxlbWVudCIsIlNjZW5lIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJwb3NpdGlvbiIsInNldCIsImFkZCIsIkRpcmVjdGlvbmFsTGlnaHQiLCJSYXljYXN0ZXIiLCJWZWN0b3IyIiwiT3JiaXRDb250cm9scyIsInJlbmRlckNvbnRlbnQiLCJyZW5kZXJTa3lib3giLCJhbmltYXRlIiwib25DbGljayIsInBpY0dlb20iLCJQbGFuZUdlb21ldHJ5IiwicGljTWF0IiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJtYXAiLCJUZXh0dXJlTG9hZGVyIiwibG9hZCIsIk1lc2giLCJuYW1lIiwicGxhbmVHZW9tIiwicGxhbmVNYXQiLCJNZXNoUGhvbmdNYXRlcmlhbCIsImNvbG9yIiwic2lkZSIsIkRvdWJsZVNpZGUiLCJwbGFuZSIsInJvdGF0aW9uIiwieCIsIk1hdGgiLCJQSSIsInoiLCJ5IiwiZm9udExvYWRlciIsIkZvbnRMb2FkZXIiLCJmb250IiwiZm9udEdlb20iLCJUZXh0R2VvbWV0cnkiLCJzaXplIiwiZm9udEZyb250IiwiZm9udFNpZGUiLCJmb250TWVzaCIsImNvbXB1dGVCb3VuZGluZ0JveCIsInRleHRXaWR0aCIsIm9iakxvYWRlciIsIk9CSkxvYWRlciIsIm1lc2giLCJzY2FsZSIsInNreWJveEdlb20iLCJDdWJlR2VvbWV0cnkiLCJza3lib3hNYXQiLCJza3lib3giLCJhc3BlY3QiLCJ1cGRhdGVQcm9qZWN0aW9uTWF0cml4IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyIiwiZSIsInByZXZlbnREZWZhdWx0IiwiY2xpZW50WCIsImNsaWVudFkiLCJjb25zb2xlIiwibG9nIiwic2V0RnJvbUNhbWVyYSIsImludGVyc2VjdHMiLCJpbnRlcnNlY3RPYmplY3RzIiwibGVuZ3RoIiwib2JqZWN0Iiwib25sb2FkIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLGNBQUo7QUFBQSxJQUNJQyxpQkFESjtBQUFBLElBRUlDLGVBRko7QUFBQSxJQUdJQyxjQUhKOztBQUtBLElBQUlDLFlBQUo7O0FBRUEsSUFBSUMsY0FBSjtBQUFBLElBQ0lDLGVBREo7O0FBR0EsSUFBSUMsa0JBQUo7QUFBQSxJQUNJQyxjQURKO0FBQUEsSUFFSUMsZ0JBRko7O0FBSUEsSUFBTUMsT0FBTyxTQUFQQSxJQUFPLEdBQU07QUFDZkMsV0FBT0MsZ0JBQVAsQ0FBd0IsUUFBeEIsRUFBa0NDLFFBQWxDLEVBQTRDLEtBQTVDOztBQUVBUixZQUFRTSxPQUFPRyxVQUFmO0FBQ0FSLGFBQVNLLE9BQU9JLFdBQVAsR0FBcUIsRUFBOUI7O0FBRUFkLGVBQVcsSUFBSWUsTUFBTUMsYUFBVixFQUFYO0FBQ0FoQixhQUFTaUIsT0FBVCxDQUFpQmIsS0FBakIsRUFBd0JDLE1BQXhCO0FBQ0FhLGFBQVNDLGNBQVQsQ0FBd0IsTUFBeEIsRUFBZ0NDLFdBQWhDLENBQTRDcEIsU0FBU3FCLFVBQXJEOztBQUVBdEIsWUFBUSxJQUFJZ0IsTUFBTU8sS0FBVixFQUFSOztBQUVBckIsYUFBUyxJQUFJYyxNQUFNUSxpQkFBVixDQUE0QixFQUE1QixFQUFnQ25CLFFBQVFDLE1BQXhDLEVBQWdELENBQWhELEVBQW1ELEtBQW5ELENBQVQ7QUFDQUosV0FBT3VCLFFBQVAsQ0FBZ0JDLEdBQWhCLENBQW9CLENBQXBCLEVBQXVCLENBQXZCLEVBQTBCLENBQTFCO0FBQ0ExQixVQUFNMkIsR0FBTixDQUFVekIsTUFBVjs7QUFFQUMsWUFBUSxJQUFJYSxN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LE9BQU9JLFdBQXJCLElBQW9DLENBQXBDLEdBQXdDLENBQWxEO0FBQ0FzRSxZQUFRQyxHQUFSLENBQVk5RSxLQUFaO0FBQ0FELGNBQVVnRixhQUFWLENBQXdCL0UsS0FBeEIsRUFBK0JOLE1BQS9CO0FBQ0EsUUFBSXNGLGFBQWFqRixVQUFVa0YsZ0JBQVYsQ0FBMkIsQ0FBQ3JGLEdBQUQsQ0FBM0IsQ0FBakI7QUFDQSxRQUFJb0YsV0FBV0UsTUFBWCxHQUFvQixDQUF4QixFQUEyQjtBQUN2QkwsZ0JBQVFDLEdBQVIsQ0FBWUUsV0FBVyxDQUFYLENBQVo7QUFDQUEsbUJBQVcsQ0FBWCxFQUFjRyxNQUFkLENBQXFCbEUsUUFBckIsQ0FBOEIrQixDQUE5QixJQUFtQyxDQUFuQztBQUNIO0FBQ0osQ0FYRDs7QUFhQSxJQUFNd0IsU0FBUyxTQUFUQSxNQUFTLEdBQU07QUFDakIvRSxhQUFTK0UsTUFBVCxDQUFnQmhGLEtBQWhCLEVBQXVCRSxNQUF2QjtBQUNILENBRkQ7O0FBS0FTLE9BQU9pRixNQUFQLEdBQWdCbEYsSUFBaEIiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNjZW5lLFxyXG4gICAgcmVuZGVyZXIsXHJcbiAgICBjYW1lcmEsXHJcbiAgICBsaWdodDtcclxuXHJcbmxldCBwaWM7XHJcblxyXG5sZXQgd2lkdGgsXHJcbiAgICBoZWlnaHQ7XHJcblxyXG5sZXQgcmF5Y2FzdGVyLFxyXG4gICAgbW91c2UsXHJcbiAgICBjb250cm9sO1xyXG5cclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSwgZmFsc2UpO1xyXG5cclxuICAgIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAyMDtcclxuXHJcbiAgICByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICByZW5kZXJlci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTtcclxuXHJcbiAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICAgIGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSg0NSwgd2lkdGggLyBoZWlnaHQsIDEsIDEwMDAwKTtcclxuICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgMCwgMik7XHJcbiAgICBzY2VuZS5hZGQoY2FtZXJhKTtcclxuXHJcbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmKTtcclxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCgwLCAxMCwgMCk7XHJcbiAgICAvLyBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZTtcclxuICAgIHNjZW5lLmFkZChsaWdodCk7XHJcblxyXG4gICAgcmF5Y2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3RlcigpO1xyXG4gICAgbW91c2UgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuICAgIGNvbnRyb2wgPSBuZXcgVEhSRUUuT3JiaXRDb250cm9scyhjYW1lcmEsIHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xyXG5cclxuICAgIHJlbmRlckNvbnRlbnQoKTtcclxuICAgIHJlbmRlclNreWJveCgpO1xyXG4gICAgYW5pbWF0ZSgpO1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xpY2ssIGZhbHNlKTtcclxufTtcclxuXHJcbmNvbnN0IHJlbmRlckNvbnRlbnQgPSAoKSA9PiB7XHJcbiAgICBjb25zdCBwaWNHZW9tID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoMSwgMSk7XHJcbiAgICBjb25zdCBwaWNNYXQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9pbWcvZGF2aWQuanBnJylcclxuICAgIH0pO1xyXG5cclxuICAgIHBpYyA9IG5ldyBUSFJFRS5NZXNoKHBpY0dlb20sIHBpY01hdCk7XHJcbiAgICBwaWMucG9zaXRpb24uc2V0KDAsIDAsIC00KTtcclxuICAgIHBpYy5uYW1lID0gJ2RhdmlkJztcclxuICAgIHNjZW5lLmFkZChwaWMpO1xyXG5cclxuICAgIGNvbnN0IHBsYW5lR2VvbSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KDcsIDcpO1xyXG4gICAgY29uc3QgcGxhbmVNYXQgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBjb2xvcjogMHhkZGRkZGQsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSk7XHJcbiAgICBjb25zdCBwbGFuZSA9IG5ldyBUSFJFRS5NZXNoKHBsYW5lR2VvbSwgcGxhbmVNYXQpO1xyXG4gICAgcGxhbmUucm90YXRpb24ueCA9IE1hdGguUEkgLyAyO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueiA9IC0xO1xyXG4gICAgcGxhbmUucG9zaXRpb24ueSA9IC0xO1xyXG4gICAgc2NlbmUuYWRkKHBsYW5lKTtcclxuXHJcbiAgICBjb25zdCBmb250TG9hZGVyID0gbmV3IFRIUkVFLkZvbnRMb2FkZXIoKTtcclxuICAgIGZvbnRMb2FkZXIubG9hZCgnLi9hc3NldHMvZm9udHMvaGVsdmV0aWtlcl9ib2xkLnR5cGVmYWNlLmpzb24nLCAoZm9udCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZvbnRHZW9tID0gbmV3IFRIUkVFLlRleHRHZW9tZXRyeSgnRGF2aWQnLCB7XHJcbiAgICAgICAgICAgIGZvbnQsXHJcbiAgICAgICAgICAgIHNpemU6IC44LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IC4yLFxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250RnJvbnQgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBjb2xvcjogMHhmZjAwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBmb250U2lkZSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBmb250TWVzaCA9IG5ldyBUSFJFRS5NZXNoKGZvbnRHZW9tLCBbZm9udEZyb250LCBmb250U2lkZV0pO1xyXG4gICAgICAgIGZvbnRNZXNoLnBvc2l0aW9uLnNldCgtMS41LCAxLCAtNCk7XHJcbiAgICAgICAgc2NlbmUuYWRkKGZvbnRNZXNoKTtcclxuXHJcbiAgICAgICAgZm9udEdlb20uY29tcHV0ZUJvdW5kaW5nQm94KCk7XHJcbiAgICAgICAgZm9udEdlb20udGV4dFdpZHRoID0gMTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IG9iakxvYWRlciA9IG5ldyBUSFJFRS5PQkpMb2FkZXIoKTtcclxuICAgIG9iakxvYWRlci5sb2FkKCcuL2Fzc2V0cy9vYmovZGF2aWRwcmludC5vYmonLCAobWVzaCkgPT4ge1xyXG4gICAgICAgIG1lc2guc2NhbGUuc2V0KC4wMiwgLjAyLCAuMDIpO1xyXG4gICAgICAgIG1lc2gucG9zaXRpb24uc2V0KC0yLjUsIC0xLCAtNCk7XHJcbiAgICAgICBzY2VuZS5hZGQobWVzaCk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmNvbnN0IHJlbmRlclNreWJveCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHNreWJveEdlb20gPSBuZXcgVEhSRUUuQ3ViZUdlb21ldHJ5KDEwMCwgMTAwLCAxMDApO1xyXG4gICAgY29uc3Qgc2t5Ym94TWF0ID0gW1xyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvZnQucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L2JrLnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC91cC5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XHJcbiAgICAgICAgICAgIG1hcDogbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcuL2Fzc2V0cy9za3lib3gvZG4ucG5nJyksXHJcbiAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcclxuICAgICAgICB9KSxcclxuICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi9hc3NldHMvc2t5Ym94L3J0LnBuZycpLFxyXG4gICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4vYXNzZXRzL3NreWJveC9sZi5wbmcnKSxcclxuICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgIH0pLFxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBza3lib3ggPSBuZXcgVEhSRUUuTWVzaChza3lib3hHZW9tLCBza3lib3hNYXQpO1xyXG4gICAgc2NlbmUuYWRkKHNreWJveCk7XHJcbn07XHJcblxyXG5cclxuY29uc3Qgb25SZXNpemUgPSAoKSA9PiB7XHJcbiAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMjA7XHJcblxyXG4gICAgY2FtZXJhLmFzcGVjdCA9IHdpZHRoIC8gaGVpZ2h0O1xyXG4gICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuICAgIHJlbmRlcmVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7XHJcbn07XHJcblxyXG5jb25zdCBhbmltYXRlID0gKCkgPT4ge1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xyXG4gICAgcmVuZGVyKCk7XHJcbn07XHJcblxyXG5jb25zdCBvbkNsaWNrID0gKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIG1vdXNlLnggPSAoZS5jbGllbnRYIC8gd2luZG93LmlubmVyV2lkdGgpICogMiAtIDE7XHJcbiAgICBtb3VzZS55ID0gLShlLmNsaWVudFkgLyB3aW5kb3cuaW5uZXJIZWlnaHQpICogMiArIDE7XHJcbiAgICBjb25zb2xlLmxvZyhtb3VzZSk7XHJcbiAgICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYShtb3VzZSwgY2FtZXJhKTtcclxuICAgIGxldCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHMoW3BpY10pO1xyXG4gICAgaWYgKGludGVyc2VjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGludGVyc2VjdHNbMF0pO1xyXG4gICAgICAgIGludGVyc2VjdHNbMF0ub2JqZWN0LnBvc2l0aW9uLnogLT0gMTtcclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IHJlbmRlciA9ICgpID0+IHtcclxuICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKVxyXG59O1xyXG5cclxuXHJcbndpbmRvdy5vbmxvYWQgPSBpbml0OyJdfQ==
